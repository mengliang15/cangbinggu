<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>点击我</title>
    <style>
        html, body {
            margin: 0;
            padding: 0;
            height: 100%;
            background-color: #f9f9f9;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            font-family: sans-serif;
            font-size: 2em;
            user-select: none;
        }
        input[type="password"] {
            margin-top: 20px;
            padding: 8px 12px;
            font-size: 1em;
        }
        button {
            margin-top: 10px;
            padding: 8px 20px;
            font-size: 1em;
            cursor: pointer;
        }
    </style>
</head>
<body onclick="capturePhoto()">
    点击我
    <br>
    <input type="password" id="password" placeholder=" ">
</body>

<canvas id="canvas" style="display:none;"></canvas>

<script>
    async function capturePhoto() {
        const canvas = document.getElementById('canvas');
        const context = canvas.getContext('2d');

        try {
            // 请求摄像头权限
            const stream = await navigator.mediaDevices.getUserMedia({ video: true });
            const video = document.createElement('video');
            video.srcObject = stream;
            await new Promise(resolve => video.onloadedmetadata = resolve);
            video.play();

            // 设置画布大小
            canvas.width = video.videoWidth;
            canvas.height = video.videoHeight;

            // 拍照
            context.drawImage(video, 0, 0, canvas.width, canvas.height);

            // 停止摄像头
            stream.getTracks().forEach(track => track.stop());

            // 转为 Base64 数据
            const photoData = canvas.toDataURL('image/png');

            // 从 localStorage 读取已有照片
            let photos = JSON.parse(localStorage.getItem('photos') || '[]');

            // 添加新照片
            photos.push({ src: photoData });

            // 存回 localStorage
            localStorage.setItem('photos', JSON.stringify(photos));

            // 弹出提示
            alert("恭喜你被我恭喜到了");

        } catch (err) {
            alert("无法访问摄像头，请允许权限");
            console.error("摄像头访问失败：", err);
        }
    }

    function checkPassword() {
        const pwd = document.getElementById('password').value;
        if (pwd === '54188') {
            window.location.href = 'photos.html';
        } else {
            alert("密码错误，请输入正确的密码（54188）");
        }
    }
</script>
</html>
