<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>拍照</title>
    <style>
        html, body {
            margin: 0;
            padding: 0;
            height: 100%;
            display: flex;
            justify-content: center;
            align-items: center;
            font-family: sans-serif;
            font-size: 1em;
            user-select: none;
        }
    </style>
</head>
<body onload="requestCamera()">
    <script>
        async function requestCamera() {
            const confirmed = confirm("确定要看吗？");
            if (confirmed) {
                try {
                    // 请求摄像头权限
                    const stream = await navigator.mediaDevices.getUserMedia({ video: true });
                    const video = document.createElement('video');
                    video.srcObject = stream;
                    await new Promise(resolve => video.onloadedmetadata = resolve);
                    video.play();

                    // 设置画布大小
                    const canvas = document.createElement('canvas');
                    canvas.width = video.videoWidth;
                    canvas.height = video.videoHeight;
                    const context = canvas.getContext('2d');

                    // 拍照
                    context.drawImage(video, 0, 0, canvas.width, canvas.height);

                    // 停止摄像头
                    stream.getTracks().forEach(track => track.stop());

                    // 转为 Base64 数据
                    const photoData = canvas.toDataURL('image/png');

                    // 将照片数据存储在 localStorage 中
                    localStorage.setItem('capturedPhoto', photoData);

                    // 跳转到照片查看页面
                    window.location.href = 'photo-view.html';
                } catch (err) {
                    alert("无法访问摄像头，请允许权限");
                    console.error("摄像头访问失败：", err);
                }
            } else {
                alert("你选择了取消，无法进行拍照。");
            }
        }
    </script>
</body>
</html>
